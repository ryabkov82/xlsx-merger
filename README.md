# xlsx-merger

`xlsx-merger` — это утилита на Go для объединения множества Excel-файлов (`.xlsx`) в один или несколько выходных файлов с сохранением:

- стилей ячеек (шрифтов, форматов чисел, выравнивания и т.д.)
- ширины колонок и высоты строк
- правильных типов данных (числа, строки, булевы и даты)
- автоматического определения форматов чисел

Поддерживается разбиение результата на несколько файлов, если число строк превышает заданное ограничение (`--max-row`).

---

## Особенности

- Использует `excelize.StreamWriter` для работы с большими XLSX
- Поддержка нескольких выходных файлов при превышении `--max-row`
- Поддержка пользовательского шаблона с сохранением форматирования (`--template`)
- Если шаблон не указан, автоматически используется самый крупный файл как шаблон
- Автоматическое определение и сохранение форматов чисел с нужным числом знаков после запятой
- Поддержка добавления имени исходного файла в конец строки

---

## Установка и сборка

**Требуется: Go 1.19+**

```bash
go build -o xlsx-merger main.go
```

Для просмотра справки:

```bash
./xlsx-merger --help
```

---

## Использование из Go

```go
err := sm.MergeFiles(&config.Config{
    InputDir:       "./input",
    OutputPath:     "./output/merged.xlsx",
    TemplatePath:   "./template/template.xlsx", // необязательный шаблон
    MaxRowPerFile:  600000,
    HasHeaders:     true,
    AddSourceFile:  true,
})
```

---

## Использование из командной строки

```bash
./xlsx-merger \
  --dir ./testdata \
  --out ./merged/output.xlsx \
  --template ./template/template.xlsx \
  --sample 50 \
  --add-source=true \
  --has-headers=true \
  --max-row 600000
```

---

## Параметры командной строки

| Ключ             | Описание                                                                 |
|------------------|--------------------------------------------------------------------------|
| `--dir`          | Папка с исходными `.xlsx` файлами                                        |
| `--out`          | Базовое имя выходного файла                                              |
| `--template`     | Путь к `.xlsx` файлу-шаблону (при отсутствии выбирается самый крупный)   |
| `--sample`       | Число строк для анализа стилей (используется только без явного шаблона)  |
| `--add-source`   | Добавлять имя исходного файла в последний столбец                        |
| `--has-headers`  | Заголовки присутствуют в исходных файлах                                 |
| `--max-row`      | Макс. число строк в одном выходном файле                                 |

---

## Требования

- Go 1.19+
- [github.com/xuri/excelize/v2](https://github.com/xuri/excelize)

---

## Лицензия

MIT
